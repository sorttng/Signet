<Page x:Class="Signet.View.AuthorityCfg_View"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:Signet.View"
      xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"      
      xmlns:mvvm="http://www.galasoft.ch/mvvmlight"
      xmlns:mah="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro"
      xmlns:Dialog="clr-namespace:MahApps.Metro.Controls.Dialogs;assembly=MahApps.Metro"
      Dialog:DialogParticipation.Register="{Binding}"
      xmlns:c="clr-namespace:Signet.Common"
      xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
      mc:Ignorable="d" 
      d:DesignHeight="450" d:DesignWidth="800"
      Title="权限配置">
    <Page.DataContext>
        <Binding Path="AuthorityCfg" Source="{StaticResource Locator}"></Binding>
    </Page.DataContext>

    <Grid Background="White">
        <mah:MetroTabControl TabStripPlacement="Left" 
                             mah:TabControlHelper.Underlined="TabPanel"
            ItemsSource="{Binding mAuthorityCfg_Model.Roles ,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"                              
            SelectedItem="{Binding mAuthorityCfg_Model.Selected_Role, Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
            DisplayMemberPath="Role_Name" SelectedValuePath="Role_ID">
            <i:Interaction.Triggers>
                <i:EventTrigger EventName="SelectionChanged">
                    <i:InvokeCommandAction Command="{Binding AuthorityChange_Command}">
                    </i:InvokeCommandAction>
                </i:EventTrigger>
            </i:Interaction.Triggers>
            <TabControl.ContentTemplate>
                <DataTemplate>
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="100*"></RowDefinition>
                            <RowDefinition Height="auto"></RowDefinition>
                        </Grid.RowDefinitions>

                        <DataGrid Grid.Row="0" 
                        IsEnabled="{Binding Source={x:Static c:AuthorizationManager.Instance},Path=[AuthorityConfig]}"
                        ItemsSource="{Binding DataContext.mAuthorityCfg_Model.AuthoritiesWithCheck,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged,
                        RelativeSource={RelativeSource AncestorType=TabControl}}"
                        AutoGenerateColumns="False" CanUserAddRows="False" VerticalScrollBarVisibility="Auto"                                      
                        CanUserSortColumns="False" 
                        mah:DataGridHelper.EnableCellEditAssist="True"
                        ScrollViewer.VerticalScrollBarVisibility="Visible"
                        ScrollViewer.HorizontalScrollBarVisibility="Visible"                                  
                        SelectionUnit="CellOrRowHeader" >
                            <DataGrid.Columns>
                                <DataGridCheckBoxColumn Header="权限分配" Binding="{Binding IsCheck,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                                                        Width="auto" IsReadOnly="False" ></DataGridCheckBoxColumn>
                                    <DataGridTextColumn Header="权限名称" Binding="{Binding Description}" Width="*" IsReadOnly="True"/>
                                <DataGridTextColumn Header="权限代号" Binding="{Binding Authority_Name}" Width="*" IsReadOnly="True"/>
                            </DataGrid.Columns>
                        </DataGrid>

                        <Button Grid.Row="1" Style="{StaticResource HeadButtonStyle}" Content="提交" HorizontalAlignment="Right"
                                IsEnabled="{Binding Source={x:Static c:AuthorizationManager.Instance},Path=[AuthorityConfig]}">
                            <i:Interaction.Triggers>
                                <i:EventTrigger EventName="Click">
                                    <i:InvokeCommandAction Command="{Binding DataContext.CommitChange_Command,RelativeSource={RelativeSource AncestorType=Page}}">
                                    </i:InvokeCommandAction>
                                </i:EventTrigger>
                            </i:Interaction.Triggers>
                        </Button>
                    </Grid>
                </DataTemplate>
            </TabControl.ContentTemplate>
        </mah:MetroTabControl>
    </Grid>
</Page>
